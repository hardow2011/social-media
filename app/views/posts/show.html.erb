<main class="section">
  <div class="container">
    <div class="block">
      <%= link_to sanitize("&larr; #{handle_path(@post.community)}"), community_path(@post.community) %>
    </div>
    <div class="block">
      <h1>
        <%= @post.caption %>
      </h1>
    </div>
    <div class="block">
      <% if current_user %>
        <%= form_with model: @comment do |f| %>
          <% if @comment.errors.any? %>
            <div>
              <%= @comment.errors.full_messages.to_sentence.capitalize %>
            </div>
          <% end %>
          <%= f.hidden_field :post_id, value: @post.id %>
          <%= f.hidden_field :user_id, value: current_user.id %>
          <div class="field">
              <%= f.label :content, "Add a Comment", class: 'label' %>
              <div class="control">
                  <%= f.text_field :content, class: 'input' %>
              </div>
          </div>
          <div class="block">
            <div class="buttons is-right">
                <%= f.submit 'Comment', class: 'button is-success' %>
            </div>
          </div>                
        <% end %>
      <% else %>
        <%# TODO: redirect to post after sign in %>
        <div class="buttons is-right">
          <%= link_to "Comment",
                new_user_session_path(redirect_to: request.path),
                class: "button is-link" %>
        </div>
      <% end %>
    </div>
    <div class="fixed-grid has-1-cols">
      <div class="grid">
        <%= render @post.comments.ordered %>
      </div>
    </div>
  </div>
</main>